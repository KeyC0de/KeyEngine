\doxysection{thread\+\_\+poolj.\+h}
\hypertarget{thread__poolj_8h_source}{}\label{thread__poolj_8h_source}\index{inc/thread\_poolj.h@{inc/thread\_poolj.h}}
\mbox{\hyperlink{thread__poolj_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <queue>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}jthread/jthread.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}jthread/stop\_token.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{non__copyable_8h}{non\_copyable.h}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{key__exception_8h}{key\_exception.h}}"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\ final}
\DoxyCodeLine{00032\ \ \ \ \ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classNonCopyable}{NonCopyable}}}
\DoxyCodeLine{00033\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classThreadPoolJ_a8340923fea4d70543e295304b154689f_a8340923fea4d70543e295304b154689f}{Task}}\ =\ std::function<void(nonstd::stop\_token)>;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\ *\mbox{\hyperlink{classThreadPoolJ_a77837e4adf53b67bef9e8ee176975eb3_a77837e4adf53b67bef9e8ee176975eb3}{s\_pInstance}};}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ std::recursive\_mutex\ \mbox{\hyperlink{classThreadPoolJ_a481df3da83614d4f7a4e0a95963bbeff_a481df3da83614d4f7a4e0a95963bbeff}{s\_mu}};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classThreadPoolJ_a1456022600a4ea8b213f5d883ddca031_a1456022600a4ea8b213f5d883ddca031}{m\_bEnabled}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00040\ \ \ \ \ std::vector<nonstd::jthread>\ \mbox{\hyperlink{classThreadPoolJ_a1b7cefb6988f2cf5c9eb395f54172a94_a1b7cefb6988f2cf5c9eb395f54172a94}{m\_pool}};}
\DoxyCodeLine{00041\ \ \ \ \ std::queue<Task>\ \mbox{\hyperlink{classThreadPoolJ_a7002faf8e57fa5b0d17e673a04de60e3_a7002faf8e57fa5b0d17e673a04de60e3}{m\_tasks}};}
\DoxyCodeLine{00042\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classThreadPoolJ_aef4dca2090783fa0b169fb574ea3e8d2_aef4dca2090783fa0b169fb574ea3e8d2}{m\_cond}};}
\DoxyCodeLine{00043\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classThreadPoolJ_a4146b8e2ffbee3f47258434d757ba944_a4146b8e2ffbee3f47258434d757ba944}{m\_mu}};}
\DoxyCodeLine{00044\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classThreadPoolJ_a45e02b36197bf6c1ed3baa2ea4ee7924_a45e02b36197bf6c1ed3baa2ea4ee7924}{ThreadPoolJ}}(\ \textcolor{keyword}{const}\ std::size\_t\ nthreads,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ bStart\ );}
\DoxyCodeLine{00046\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ_acd20215772d41c1709c3d0403524189d_acd20215772d41c1709c3d0403524189d}{\string~ThreadPoolJ}}()\ noexcept;}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}(\ const\ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\ \&rhs\ )\ =\ delete;}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\&\ operator=(\ const\ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\ \&rhs\ )\ =\ delete;}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}(\ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\ \&\&rhs\ )\ noexcept;}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\&\ operator=(\ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\ \&\&rhs\ )\ noexcept;}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ static\ \mbox{\hyperlink{classThreadPoolJ}{ThreadPoolJ}}\&\ \mbox{\hyperlink{classThreadPoolJ_a0c0e12a8c7197ac7954aaae0a10a4809_a0c0e12a8c7197ac7954aaae0a10a4809}{getInstance}}(\ const\ std::\textcolor{keywordtype}{size\_t}\ nThreads\ =\ 4u,\ const\ \textcolor{keywordtype}{bool}\ bEnabled\ =\ true\ );}
\DoxyCodeLine{00054\ \ \ \ \ static\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_a900b4ee770a970d62cfdb78805dce633_a900b4ee770a970d62cfdb78805dce633}{resetInstance}}()\ noexcept;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_a4eed8445982bec0c3530502424a813a4_a4eed8445982bec0c3530502424a813a4}{start}}();}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_a3cfc8aad20e8b95f97f7891651b3b9a4_a3cfc8aad20e8b95f97f7891651b3b9a4}{stop}}()\ noexcept;}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classThreadPoolJ_a5b29093e3f530a39ff112af3ccf9ce49_a5b29093e3f530a39ff112af3ccf9ce49}{isEnabled}}()\ const\ noexcept;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ template<typename\ TCallable,\ typename...\ TArgs>}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_a8d1fb8a147b9e4799a4e5b9c694f9e39_a8d1fb8a147b9e4799a4e5b9c694f9e39}{enqueue}}(\ TCallable\ \&\&f,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ TArgs\ \&\&...args\ )}
\DoxyCodeLine{00064\ \ \ \ \ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classThreadPoolJ_a1456022600a4ea8b213f5d883ddca031_a1456022600a4ea8b213f5d883ddca031}{m\_bEnabled}}\ )}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ task\ =\ std::bind(\ std::move(\ f\ ),\ std::placeholders::\_1,\ std::forward<TArgs>(\ args\ )...\ );}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ ul\{\mbox{\hyperlink{classThreadPoolJ_a4146b8e2ffbee3f47258434d757ba944_a4146b8e2ffbee3f47258434d757ba944}{m\_mu}}\};}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ_a7002faf8e57fa5b0d17e673a04de60e3_a7002faf8e57fa5b0d17e673a04de60e3}{m\_tasks}}.emplace(\ std::move(\ task\ )\ );}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThreadPoolJ_aef4dca2090783fa0b169fb574ea3e8d2_aef4dca2090783fa0b169fb574ea3e8d2}{m\_cond}}.notify\_one();}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bindable__exception_8h_ad3b2ea7a349e411ed47fba062fe034f2_ad3b2ea7a349e411ed47fba062fe034f2}{THROW\_KEY\_EXCEPTION}}(\ \textcolor{stringliteral}{"{}Cannot\ enqueue\ tasks\ in\ an\ inactive\ Thread\ Pool!"{}}\ );}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_acff3f687fabbf39480d9a4209a67904e_acff3f687fabbf39480d9a4209a67904e}{enable}}()\ noexcept;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_a60154491a2f3080b64bafa4482325a3a_a60154491a2f3080b64bafa4482325a3a}{disable}}()\ noexcept;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThreadPoolJ_a88b07ec3d369564de821d10986091426_a88b07ec3d369564de821d10986091426}{run}}();}
\DoxyCodeLine{00084\ \};}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ namespace\ \mbox{\hyperlink{namespacefunc__async}{func\_async}}}
\DoxyCodeLine{00088\ \{}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacefunc__async_a224c931f9dead8e231b14ceb26da3617_a224c931f9dead8e231b14ceb26da3617}{doPeriodically}}(\ nonstd::stop\_token\ st,\ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void})>\ \&f,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ intervalMs,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ now\ );}
\DoxyCodeLine{00093\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacefunc__async_a5f3e4ca374f7de72954d29184be8f06d_a5f3e4ca374f7de72954d29184be8f06d}{doLater}}(\ nonstd::stop\_token\ st,\ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{void}(\textcolor{keywordtype}{void})>\ \&f,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ intervalMs\ );}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \}\textcolor{comment}{//\ namespace\ func\_async}}

\end{DoxyCode}
