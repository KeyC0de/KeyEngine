\doxysection{object\+\_\+pool.\+h}
\hypertarget{object__pool_8h_source}{}\label{object__pool_8h_source}\index{inc/object\_pool.h@{inc/object\_pool.h}}
\mbox{\hyperlink{object__pool_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{non__copyable_8h}{non\_copyable.h}}"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00008\ \textcolor{comment}{//\ \(\backslash\)class\ \ \ ObjectPool}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \(\backslash\)author\ \ Nikos\ Lazaridis\ (KeyC0de)}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ \(\backslash\)date\ \ \ \ 3-\/Oct-\/19}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ \(\backslash\)brief\ \ \ Pool\ Allocator}}
\DoxyCodeLine{00013\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00014\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classObjectPool}{ObjectPool}}\ final}
\DoxyCodeLine{00015\ \ \ \ \ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classNonCopyable}{NonCopyable}}}
\DoxyCodeLine{00016\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keyword}{union\ }\mbox{\hyperlink{unionObjectPool_1_1Object}{Object}}}
\DoxyCodeLine{00018\ \ \ \ \ \{}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ std::aligned\_storage\_t<\textcolor{keyword}{sizeof}(\ T\ ),\ \textcolor{keyword}{alignof}(\ T\ )>\ \mbox{\hyperlink{unionObjectPool_1_1Object_aef47ca0147f05b119bf29b783b22c78a_aef47ca0147f05b119bf29b783b22c78a}{m\_storage}};}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{unionObjectPool_1_1Object}{Object}}\ *\mbox{\hyperlink{unionObjectPool_1_1Object_a74ec427780260e3b1ef8ae21fd6d60ae_a74ec427780260e3b1ef8ae21fd6d60ae}{m\_pNext}};}
\DoxyCodeLine{00021\ \ \ \ \ \};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ std::unique\_ptr<Object[]>\ \mbox{\hyperlink{classObjectPool_a9f4f64b95a30f89419809ee8f30fc92f_a9f4f64b95a30f89419809ee8f30fc92f}{m\_pool}};}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{unionObjectPool_1_1Object}{Object}}\ *\mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}};}
\DoxyCodeLine{00025\ \ \ \ \ std::size\_t\ \mbox{\hyperlink{classObjectPool_ac393625c067bea5325dd1978084e6b47_ac393625c067bea5325dd1978084e6b47}{m\_nObjs}};}
\DoxyCodeLine{00026\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classObjectPool_a3e774e7272b0a82d646ffac444289db6_a3e774e7272b0a82d646ffac444289db6}{value\_type}}\ =\ T;}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classObjectPool_a8c28e441fbf200b22110784d2d22ab36_a8c28e441fbf200b22110784d2d22ab36}{pointer}}\ =\ T*;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classObjectPool_ae3b6a071a40dec3b4acc5a873c416b01_ae3b6a071a40dec3b4acc5a873c416b01}{ObjectPool}}(\ \textcolor{keyword}{const}\ std::size\_t\ nObjs\ )}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_a9f4f64b95a30f89419809ee8f30fc92f_a9f4f64b95a30f89419809ee8f30fc92f}{m\_pool}}\{std::make\_unique<\mbox{\hyperlink{unionObjectPool_1_1Object}{Object}}[]>(\ nObjs\ )\},}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}}\{nullptr\},}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_ac393625c067bea5325dd1978084e6b47_ac393625c067bea5325dd1978084e6b47}{m\_nObjs}}(nObjs)}
\DoxyCodeLine{00036\ \ \ \ \ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ nObjs;\ ++i\ )}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_a9f4f64b95a30f89419809ee8f30fc92f_a9f4f64b95a30f89419809ee8f30fc92f}{m\_pool}}[i\ -\/\ 1].m\_pNext\ =\ \&\mbox{\hyperlink{classObjectPool_a9f4f64b95a30f89419809ee8f30fc92f_a9f4f64b95a30f89419809ee8f30fc92f}{m\_pool}}[i];}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}}\ =\ \&\mbox{\hyperlink{classObjectPool_a9f4f64b95a30f89419809ee8f30fc92f_a9f4f64b95a30f89419809ee8f30fc92f}{m\_pool}}[0];}
\DoxyCodeLine{00043\ \ \ \ \ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classObjectPool_a93dd6b1dbb1f87e2e25cceb13d76e0ab_a93dd6b1dbb1f87e2e25cceb13d76e0ab}{\string~ObjectPool}}()\ noexcept\ =\ default;}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classObjectPool}{ObjectPool}}(\ \mbox{\hyperlink{classObjectPool}{ObjectPool}}\ \&\&rhs\ )\ noexcept}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_a9f4f64b95a30f89419809ee8f30fc92f_a9f4f64b95a30f89419809ee8f30fc92f}{m\_pool}}\{std::move(\ rhs.m\_pool\ )\},}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}}\{rhs.m\_pNextFree\},}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_ac393625c067bea5325dd1978084e6b47_ac393625c067bea5325dd1978084e6b47}{m\_nObjs}}\{rhs.getSize()\}}
\DoxyCodeLine{00052\ \ \ \ \ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ rhs.m\_pNextFree\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{classObjectPool}{ObjectPool}}\&\ \mbox{\hyperlink{classObjectPool_aef644afca4b172a0826e7597ecb4e1a5_aef644afca4b172a0826e7597ecb4e1a5}{operator=}}(\ \mbox{\hyperlink{classObjectPool}{ObjectPool}}\ \&\&rhs\ )\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00057\ \ \ \ \ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool}{ObjectPool}}\ tmp\{std::move(\ rhs\ )\};}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ std::swap(\ *\textcolor{keyword}{this},\ tmp\ );}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00061\ \ \ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structObjectPool_1_1rebind}{rebind}}}
\DoxyCodeLine{00065\ \ \ \ \ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classObjectPool}{otherAllocator}}\ =\ \mbox{\hyperlink{classObjectPool}{ObjectPool<U>}};}
\DoxyCodeLine{00067\ \ \ \ \ \};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ T*\ \mbox{\hyperlink{classObjectPool_a2730a24e7e924ddcf0cee57d35866528_a2730a24e7e924ddcf0cee57d35866528}{address}}(\ T\ \&r\ )\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00070\ \ \ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&r;}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{const}\ T*\ \mbox{\hyperlink{classObjectPool_a26818f2614771d79e113207b54f6ca31_a26818f2614771d79e113207b54f6ca31}{address}}(\ \textcolor{keyword}{const}\ T\ \&r\ )\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00075\ \ \ \ \ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&r;}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ add\ object\ to\ the\ list}}
\DoxyCodeLine{00080\ \ \ \ \ [[nodiscard]]}
\DoxyCodeLine{00081\ \ \ \ \ T*\ \mbox{\hyperlink{classObjectPool_aade24458eccdfddc0ec175a5cec8d1ea_aade24458eccdfddc0ec175a5cec8d1ea}{allocate}}()}
\DoxyCodeLine{00082\ \ \ \ \ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}}\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::bad\_alloc\{\};}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ currentObj\ =\ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}};}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}}\ =\ currentObj-\/>\mbox{\hyperlink{unionObjectPool_1_1Object_a74ec427780260e3b1ef8ae21fd6d60ae_a74ec427780260e3b1ef8ae21fd6d60ae}{m\_pNext}};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{reinterpret\_cast<}T*\textcolor{keyword}{>}(\ \&currentObj-\/>m\_storage\ );}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ remove\ object\ from\ the\ list}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classObjectPool_a9a0046c3811cd3b22b45c7c730d85915_a9a0046c3811cd3b22b45c7c730d85915}{deallocate}}(\ T\ *p,}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ [[maybe\_unused]]\ std::size\_t\ count\ =\ 0\ )\ noexcept}
\DoxyCodeLine{00097\ \ \ \ \ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ o\ =\ \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{unionObjectPool_1_1Object}{Object}}*\textcolor{keyword}{>}(\ p\ );}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ o-\/>\mbox{\hyperlink{unionObjectPool_1_1Object_a74ec427780260e3b1ef8ae21fd6d60ae_a74ec427780260e3b1ef8ae21fd6d60ae}{m\_pNext}}\ =\ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}};}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_aaa415b3cb968dcb61ef6711f4d3c4c03_aaa415b3cb968dcb61ef6711f4d3c4c03}{m\_pNextFree}}\ =\ o;}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ pass\ ctor\ args}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}...\ TArgs>}
\DoxyCodeLine{00105\ \ \ \ \ [[nodiscard]]}
\DoxyCodeLine{00106\ \ \ \ \ T*\ \mbox{\hyperlink{classObjectPool_a00b06a510030de58a1cea2ca9cc3c8fa_a00b06a510030de58a1cea2ca9cc3c8fa}{construct}}(\ TArgs...\ args\ )}
\DoxyCodeLine{00107\ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ (\ \mbox{\hyperlink{classObjectPool_aade24458eccdfddc0ec175a5cec8d1ea_aade24458eccdfddc0ec175a5cec8d1ea}{allocate}}()\ )\ T\{std::forward<TArgs>(\ args\ )...\};}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classObjectPool_a874712d8c259e45121f90be4a2542cc3_a874712d8c259e45121f90be4a2542cc3}{destroy}}(\ T\ *p\ )\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00112\ \ \ \ \ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ p\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ p-\/>\string~T();}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classObjectPool_a9a0046c3811cd3b22b45c7c730d85915_a9a0046c3811cd3b22b45c7c730d85915}{deallocate}}(\ p\ );}
\DoxyCodeLine{00120\ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ std::size\_t\ \mbox{\hyperlink{classObjectPool_a422f245c28eb4070c9ca3a5d479e3012_a422f245c28eb4070c9ca3a5d479e3012}{getSize}}()\ noexcept}
\DoxyCodeLine{00123\ \ \ \ \ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classObjectPool_ac393625c067bea5325dd1978084e6b47_ac393625c067bea5325dd1978084e6b47}{m\_nObjs}};}
\DoxyCodeLine{00125\ \ \ \ \ \}}
\DoxyCodeLine{00126\ \};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keyword}{class}\ Other>}
\DoxyCodeLine{00129\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{object__pool_8h_a858ae6fa8bae9073ca6cd84741bdee8a_a858ae6fa8bae9073ca6cd84741bdee8a}{operator==}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classObjectPool}{ObjectPool<T>}}\&\ lhs,}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classObjectPool}{ObjectPool<Other>}}\&\ rhs\ )\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00131\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{return}\ lhs.m\_pool\ ==\ rhs.m\_pool;}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keyword}{class}\ Other>}
\DoxyCodeLine{00136\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{object__pool_8h_aa5e2bc8b1103fb971039f01ffd028917_aa5e2bc8b1103fb971039f01ffd028917}{operator!=}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classObjectPool}{ObjectPool<T>}}\&\ lhs,}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classObjectPool}{ObjectPool<Other>}}\&\ rhs\ )\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00138\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordflow}{return}\ lhs.m\_pool\ !=\ rhs.m\_pool;}
\DoxyCodeLine{00140\ \}}

\end{DoxyCode}
